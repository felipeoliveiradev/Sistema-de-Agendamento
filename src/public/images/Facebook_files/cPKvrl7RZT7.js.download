if (self.CavalryLogger) { CavalryLogger.start_js(["Mdmqf"]); }

__d("react-relay-deprecated/classic/store/RelayQueryWriter",["invariant","react-relay-deprecated/classic/interface/RelayNodeInterface","react-relay-deprecated/classic/legacy/store/generateClientEdgeID","react-relay-deprecated/classic/legacy/store/generateClientID","react-relay-deprecated/classic/query/RelayQuery","react-relay-deprecated/classic/query/RelayQueryPath","react-relay-deprecated/classic/query/RelayQueryVisitor","react-relay-deprecated/classic/tools/isCompatibleRelayFragmentType","react-relay-deprecated/classic/store/RelayClassicRecordState","react-relay-deprecated/classic/store/RelayRecord","relay-runtime","warning"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h,i=b("relay-runtime").ConnectionInterface,j=b("react-relay-deprecated/classic/interface/RelayNodeInterface").ANY_TYPE,k=b("react-relay-deprecated/classic/interface/RelayNodeInterface").ID,l=b("react-relay-deprecated/classic/interface/RelayNodeInterface").TYPENAME,m=b("react-relay-deprecated/classic/store/RelayClassicRecordState").EXISTENT;c=babelHelpers.inherits(a,b("react-relay-deprecated/classic/query/RelayQueryVisitor"));h=c&&c.prototype;function a(a,b,c,d,e){h.constructor.call(this),this.$RelayQueryWriter1=d,this.$RelayQueryWriter2=e&&e.forceIndex?e.forceIndex:0,this.$RelayQueryWriter3=!!(e&&e.isOptimisticUpdate),this.$RelayQueryWriter4=a,this.$RelayQueryWriter5=c,this.$RelayQueryWriter6=!!(e&&e.updateTrackedQueries),this.$RelayQueryWriter7=b}a.prototype.getRecordStore=function(){return this.$RelayQueryWriter4};a.prototype.getRecordWriter=function(){return this.$RelayQueryWriter7};a.prototype.getRecordTypeName=function(a,c,d){if(this.$RelayQueryWriter3)return this.$RelayQueryWriter4.getType(c);d=d[l];d==null&&(!a.isAbstract()?d=a.getType():d=this.$RelayQueryWriter4.getType(c));b("warning")(d&&d!==j,"RelayQueryWriter: Could not find a type name for record `%s`.",c);return d||null};a.prototype.writePayload=function(a,c,d,e){var f={nodeID:null,path:e,recordID:c,responseData:d};if(a instanceof b("react-relay-deprecated/classic/query/RelayQuery").Field&&a.canHaveSubselections()){a.getChildren().forEach(function(a){this.visit(a,f)}.bind(this));return}this.visit(a,f)};a.prototype.recordCreate=function(a){this.$RelayQueryWriter1.createID(a)};a.prototype.recordUpdate=function(a){this.$RelayQueryWriter1.updateID(a)};a.prototype.isNewRecord=function(a){return this.$RelayQueryWriter1.isNewRecord(a)};a.prototype.createRecordIfMissing=function(a,c,d,e){var f=this.$RelayQueryWriter4.getRecordState(c);e=e&&this.getRecordTypeName(a,c,e);this.$RelayQueryWriter7.putRecord(c,e,d);f!==m&&this.recordCreate(c);this.$RelayQueryWriter5&&(this.isNewRecord(c)||this.$RelayQueryWriter6)&&(!b("react-relay-deprecated/classic/store/RelayRecord").isClientID(c)||b("react-relay-deprecated/classic/query/RelayQueryPath").isRootPath(d))&&this.$RelayQueryWriter5.trackNodeForID(a,c)};a.prototype.visitRoot=function(a,b){__p&&__p();var c=b.path,d=b.recordID,e=b.responseData,f=this.$RelayQueryWriter4.getRecordState(d);if(e==null){e!==void 0||g(0,4329,d);this.$RelayQueryWriter7.deleteRecord(d);f===m&&this.recordUpdate(d);return}typeof e==="object"&&e!==null||g(0,4330,d);this.createRecordIfMissing(a,d,c,e);this.traverse(a,b)};a.prototype.visitFragment=function(a,c){__p&&__p();var d=c.recordID;if(a.isDeferred()){var e=a.getSourceCompositeHash()||a.getCompositeHash();this.$RelayQueryWriter7.setHasDeferredFragmentData(d,e);this.recordUpdate(d)}if(this.$RelayQueryWriter3||b("react-relay-deprecated/classic/tools/isCompatibleRelayFragmentType")(a,this.$RelayQueryWriter4.getType(d))){!this.$RelayQueryWriter3&&a.isTrackingEnabled()&&this.$RelayQueryWriter7.setHasFragmentData(d,a.getCompositeHash());e=b("react-relay-deprecated/classic/query/RelayQueryPath").getPath(c.path,a,d);this.traverse(a,babelHelpers["extends"]({},c,{path:e}))}};a.prototype.visitField=function(a,c){__p&&__p();var d=c.recordID,e=c.responseData;this.$RelayQueryWriter7.getRecordState(d)===m||g(0,4331,d);typeof e==="object"&&e!==null||g(0,4332,d);var f=a.getSerializationKey(),h=e[f];if(h==null){if(h===void 0)if(Object.prototype.hasOwnProperty.call(e,f)){b("warning")(!1,"RelayQueryWriter: Encountered an explicit `undefined` field `%s` on record `%s`, expected response to not contain `undefined`.",a.getDebugName(),d);return}else if(this.$RelayQueryWriter3)return;e=a.getStorageKey();f=this.$RelayQueryWriter4.getField(d,e);this.$RelayQueryWriter7.deleteField(d,e);f!==null&&this.recordUpdate(d);return}!a.canHaveSubselections()?this.$RelayQueryWriter8(a,c,d,h):a.isConnection()?this.$RelayQueryWriter9(a,c,d,h):a.isPlural()?this.$RelayQueryWriter10(a,c,d,h):this.$RelayQueryWriter11(a,c,d,h)};a.prototype.$RelayQueryWriter8=function(a,b,c,d){b=a.getStorageKey();a=this.$RelayQueryWriter4.getField(c,b);this.$RelayQueryWriter7.putField(c,b,d);if(Array.isArray(a)&&Array.isArray(d)&&a.length===d.length&&a.every(function(a,b){return a===d[b]}))return;else if(a===d)return;this.recordUpdate(c)};a.prototype.$RelayQueryWriter9=function(a,c,d,e){__p&&__p();var f=i.get();f=f.EDGES;var g=a.getStorageKey(),h=this.$RelayQueryWriter4.getLinkedRecordID(d,g)||b("react-relay-deprecated/classic/legacy/store/generateClientID")(),j=this.$RelayQueryWriter4.getRecordState(h);f=!!(a.getFieldByStorageKey(f)||e!=null&&typeof e==="object"&&e[f]);c=b("react-relay-deprecated/classic/query/RelayQueryPath").getPath(c.path,a,h);this.$RelayQueryWriter7.putRecord(h,null,c);this.$RelayQueryWriter7.putLinkedRecordID(d,g,h);j!==m&&(this.recordUpdate(d),this.recordCreate(h));f&&((!this.$RelayQueryWriter7.hasRange(h)||this.$RelayQueryWriter2&&this.$RelayQueryWriter2>this.$RelayQueryWriter4.getRangeForceIndex(h))&&this.$RelayQueryWriter7.putRange(h,a.getCallsWithValues(),this.$RelayQueryWriter2),this.recordUpdate(h));g={nodeID:null,path:c,recordID:h,responseData:e};this.$RelayQueryWriter12(a,a,g)};a.prototype.$RelayQueryWriter12=function(a,c,d){var e=i.get(),f=e.EDGES,g=e.PAGE_INFO;c.getChildren().forEach(function(c){c instanceof b("react-relay-deprecated/classic/query/RelayQuery").Field?c.getSchemaName()===f?this.$RelayQueryWriter13(a,c,d):c.getSchemaName()!==g&&this.visit(c,d):this.$RelayQueryWriter12(a,c,d)}.bind(this))};a.prototype.$RelayQueryWriter13=function(a,c,d){__p&&__p();var e=i.get(),f=e.EDGES,h=e.NODE;e=e.PAGE_INFO;var j=d.recordID,l=d.responseData;typeof l==="object"&&l!==null||g(0,4333,a.getDebugName(),j);f=l[f];if(f==null){b("warning")(!1,"RelayQueryWriter: Cannot write edges for connection `%s` on record `%s`, expected a response for field `edges`.",a.getDebugName(),j);return}Array.isArray(f)||g(0,4334,a.getDebugName(),j);var m=a.getCallsWithValues();i.hasRangeCalls(m)||g(0,4335,j);var n=this.$RelayQueryWriter4.getRangeMetadata(j,m);n||g(0,4336,a.getDebugName(),j);var o=[],p=n.filteredEdges,q=!1,r=0;f.forEach(function(e){__p&&__p();if(e==null)return;typeof e==="object"&&e||g(0,4337,a.getDebugName(),j);var f=e[h];if(f==null)return;typeof f==="object"||g(0,4338,a.getDebugName(),j);var i=p[r++];f=f&&f[k]||i&&this.$RelayQueryWriter4.getLinkedRecordID(i.edgeID,h)||b("react-relay-deprecated/classic/legacy/store/generateClientID")();var l=b("react-relay-deprecated/classic/legacy/store/generateClientEdgeID")(j,f),m=b("react-relay-deprecated/classic/query/RelayQueryPath").getPath(d.path,c,l);this.createRecordIfMissing(c,l,m,null);o.push(l);this.traverse(c,{nodeID:f,path:m,recordID:l,responseData:e});q=q||!i||l!==i.edgeID}.bind(this));n=l[e]||i.getDefaultPageInfo();this.$RelayQueryWriter7.putRangeEdges(j,m,n,o);q&&this.recordUpdate(j)};a.prototype.$RelayQueryWriter10=function(a,c,d,e){__p&&__p();var f=a.getStorageKey();Array.isArray(e)||g(0,4339,a.getDebugName(),d);var h=this.$RelayQueryWriter4.getLinkedRecordIDs(d,f),i=[],j={},l=!1,m=0;e.forEach(function(d){__p&&__p();if(d==null)return;typeof d==="object"&&d||g(0,4340,f);var e=h&&h[m],n=d[k]||e||b("react-relay-deprecated/classic/legacy/store/generateClientID")();i.push(n);var o=b("react-relay-deprecated/classic/query/RelayQueryPath").getPath(c.path,a,n);this.createRecordIfMissing(a,n,o,d);j[n]={record:d,path:o};l=l||n!==e;m++}.bind(this));this.$RelayQueryWriter7.putLinkedRecordIDs(d,f,i);i.forEach(function(b){var c=j[b];c&&this.traverse(a,{nodeID:null,path:c.path,recordID:b,responseData:c.record})}.bind(this));(l||!h||h.length!==i.length)&&this.recordUpdate(d)};a.prototype.$RelayQueryWriter11=function(a,c,d,e){__p&&__p();var f=i.get();f=f.NODE;var h=c.nodeID,j=a.getStorageKey();typeof e==="object"&&e!==null||g(0,4341,a.getDebugName(),d);var l=this.$RelayQueryWriter4.getLinkedRecordID(d,j);f=a.getSchemaName()===f&&h||e[k]||l||b("react-relay-deprecated/classic/legacy/store/generateClientID")();h=b("react-relay-deprecated/classic/query/RelayQueryPath").getPath(c.path,a,f);this.createRecordIfMissing(a,f,h,e);this.$RelayQueryWriter7.putLinkedRecordID(d,j,f);l!==f&&this.recordUpdate(d);this.traverse(a,{nodeID:null,path:h,recordID:f,responseData:e})};e.exports=a}),null);